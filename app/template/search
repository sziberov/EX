<?
	$query = trim($_GET['query'] ?? '');

	try {
		$user = new Object_($_GET['user_id'] ?? null);

		if($user->type_id != 2) {
			$user = null;
		}
	} catch(Exception $e) {}
	try {
		$section = new Object_($_GET['section_id'] ?? null);

		if($section->type_id != 3) {
			$section = null;
		}
	} catch(Exception $e) {}
?>
<title><?= dictionary_getPageTitle(D['title_search'].(!empty($query) ? ' "'.$query.'"' : '')); ?></title>
<form _grid="h">
	<input size_="large" name="query" type="text" value="<?= $query; ?>">
	<? if(!empty($user)) { ?>
		<input name="user_id" type="hidden" value="<?= $user->id; ?>">
	<? }
	   if(!empty($section)) { ?>
		<input name="section_id" type="hidden" value="<?= $section->id; ?>">
	<? } ?>
	<button primary_ type="submit"><?= D['button_search']; ?></button>
</form>
<div>Не можете найти что-то - напишите в <a href="/view/0">Ищем и находим</a></div>
<? if(!empty($user) || !empty($section)) { ?>
	<div _properties>
		<? if(!empty($user)) { ?>
			<div>
				<div><?= D['string_user']; ?></div>
				<a href="/user/<?= $user->login; ?>"><?= $user->login; ?></a>
			</div>
		<? }
		   if(!empty($section)) { ?>
			<div>
				<div><?= D['string_section']; ?></div>
				<a href="/view/<?= $section->id; ?>"><?= $section->title; ?></a>
			</div>
		<? } ?>
	</div>
<? }

	if(!empty($query)) {
		$template = new Template('objects');
		$template->navigation_mode_id = 2;
		$template->navigation_page = $navigation_page;
		$template->navigation_items_per_page = $navigation_items_per_page;
		$template->search_condition = object_getGenericSearchCondition($query, $user->id ?? null, $section->id ?? null);
		$template->display_mode_id = 1;
		$template->render(true);

		if(!empty($user) || !empty($section)) { ?>
			<div _grid="h">
				<a _button href="/search?query=<?= $query; ?>"><?= D['button_search_everywhere']; ?></a>
			</div>
		<? }
	}
?>
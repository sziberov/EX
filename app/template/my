<?
	try {
		$object = new Object_($path[1] ?? null);
	} catch(Exception $e) {
		$error = D['error_page_not_found'];
		http_response_code(404);
		return include 'error';
	}

	if(!session()) {
		return include 'login';
	}

	if($object->type_id == 4 || $object->access_level_id == 0) {
		$error = D['error_page_forbidden'];
		http_response_code(403);
		return include 'error';
	}

	$presets = [
		2	=> 'Друзья',
		4	=> 'Страница',
		6	=> 'Рекомендации',
		7	=> 'Аватары',
		9	=> 'Шаблоны',
		10	=> 'Закладки'
	];

	if($object->type_id != 2) {
		unset($presets[2]);
	}
?>
<title><?= dictionary_getPageTitle($object->title.' - '.D['title_my']); ?></title>
<div _title="small">
	<a href="/<?= $object->id; ?>"><?= $object->title; ?></a>
</div>
<div _title><?= D['title_my']; ?></div>
<div _table="list" wide_ style="--columns: repeat(4, minmax(96px, 1fr));">
	<div header_>
		<div><?= D['string_section']; ?></div>
		<div><?= D['string_objects_count']; ?></div>
		<div><?= D['string_redaction']; ?></div>
		<div></div>
	</div>
	<? foreach($object->settings as $setting) { ?>
		<div>
			<div><?= $setting->key; ?></div>
			<div>
				<div _description="short straight"><?= $setting->value; ?></div>
			</div>
			<div>
				<?
					$template = new Template('user');
					$template->object = $setting->user;
					$template->primary_time = $setting->edit_time;
					$template->render(true);
				?>
			</div>
			<div>
				<button><?= D['button_remove']; ?></button>
			</div>
		</div>
	<? } ?>
	<div footer_ switch_="current" data-switch="edit">
		<div>
			<a data-switch-ref="edit"><u><?= D['link_add']; ?></u></a>
		</div>
		<div></div>
		<div></div>
		<div></div>
	</div>
	<div footer_ switch_ data-switch="edit">
		<div>
			<select name="section">
				<? foreach($presets as $k => $v) { ?>
					<option value="<?= $k; ?>"><?= $v; ?></option>
				<? } ?>
			</select>
		</div>
		<div></div>
		<div></div>
		<div>
			<button><?= D['button_save']; ?></button>
			<button data-switch-ref="edit"><?= D['button_cancel']; ?></button>
		</div>
	</div>
</div>




<!--
<div _table="list" wide_ style="--columns: repeat(3, minmax(96px, 1fr));">
	<div header_>
		<div>Раздел</div>
		<div>Когда</div>
		<div>Включений</div>
	</div>
	<div>
		<div>
			<label _check>
				<input name="" type="checkbox" checked>
				<div></div>
				<div>Страница</div>
			</label>
		</div>
		<div>00:00, 01 января 2019</div>
		<div>3</div>
	</div>
	<div>
		<div>
			<label _check>
				<input name="" type="checkbox" checked>
				<div></div>
				<div>Рекомендации</div>
			</label>
		</div>
		<div></div>
		<div>6</div>
	</div>
	<div>
		<div>
			<label _check>
				<input name="" type="checkbox" checked>
				<div></div>
				<div>Аватары</div>
			</label>
		</div>
		<div></div>
		<div>12</div>
	</div>
	<div>
		<div>
			<label _check>
				<input name="" type="checkbox" checked>
				<div></div>
				<div>Шаблоны</div>
			</label>
		</div>
		<div></div>
		<div>24</div>
	</div>
	<div>
		<div>
			<label _check>
				<input name="" type="checkbox" checked>
				<div></div>
				<div>Закладки</div>
			</label>
		</div>
		<div></div>
		<div>8</div>
	</div>
</div>
<div _grid="h">
	<button onclick="Hash.set('view/_ID_')">Сохранить</button>
	<button onclick="Hash.set('view/_ID_')">Отменить</button>
</div>
<div _table="" style="--columns: repeat(2, minmax(0, max-content));">
	<div>
		<div></div>
		<div _title="" centered_="">Включение объекта в мои разделы</div>
	</div>
	<div>
		<div>Объект</div>
		<div>Без названия</div>
	</div>
	<div>
		<div>Действия</div>
		<div _flex="v stacked left">
			<div name="action_id" value="1" _check="">
				<div></div>
				<div>Добавить в быстрый доступ для гостей</div>
			</div>
			<div name="action_id" value="2" _check="">
				<div></div>
				<div>Рекомендовать объект</div>
			</div>
		<div name="action_id" value="2" _check="active">
				<div></div>
				<div>Использовать постер объекта как аватар</div>
			</div><div name="action_id" value="2" _check="">
				<div></div>
				<div>Использовать файлы объекта как ресурсы шаблона</div>
			</div><div name="action_id" value="2" _check="">
				<div></div>
				<div>Запомнить для последующего включения в разделы</div>
			</div></div>
	</div>
	<div>
		<div></div>
		<div>
			<button onclick="Hash.set('view/_ID_')">Выполнить</button>
			<button onclick="Hash.set('view/_ID_')">Отменить</button>
		</div>
	</div>
</div>
-->